/*
<<<<<<< HEAD
   pm.build.js ,version 1.2.1 ,updated on 2017-04-14
=======
   pm.build.js ,version 1.2.1 ,updated on 2016-09-11
>>>>>>> d5323f8dd6e05260344fee86d650455c6f6cfdc1
   module for Plugins Modules library.

   https://github.com/donghanji/pm
 */

<<<<<<< HEAD
!function(){if(void 0===module.declare)throw"There is no global module.declare method!";var a=module.globals("$");module.declare("pm.mobi",[a,"pm","pm.view","os"],function(b){function c(a){return c.history?c.history:(this.baseURI=a.baseURI,this.timestamp=a.timestamp,this.init(a.el,a.title,a.state),void(c.history=this))}function d(a){a=a||{};var b=f('[data-role="views"]');if(!b.length)return console.log('there is must be a views el,data-role="views" setting');d.options=a,d.baseURI=j,d.zIndex=a.zIndex||100,d.normalWidth=a.normalWidth||640,d.normalMaxWidth=a.normalMaxWidth||768,d.normalMinWidth=a.normalMinWidth||320,d.basePX=a.normalPx||100,d.historyGoIndex=0,d.historyOptions={};var c=a.historyTimeStamp;c===!0&&(c="t"),d.historyTimeStamp=c?c:"",d.translateDuration=parseInt(a.duration||400),d.translateDirection=a.direction||"left",d.translateOffset=a.translateOffset||60,d.translateDelay=a.translateDelay||1,d.directions=a.directions||{left:"left",right:"right",up:"up",down:"down"},d.opposites=a.opposites||{left:"right",right:"left",up:"down",down:"up"},d.$views=b,d.$gheader=f('[data-role="views"] > [data-role="global-header"]'),d.$gfooter=f('[data-role="views"] > [data-role="global-footer"]'),d.markup=a.markup||"div",d.init(b)}function e(a){return e.mobi?e.mobi:(new d(a),e.mobi=this,this)}var f=b(a),g=b("pm"),h=g.ns("view"),i=b("os"),j=window.location.pathname,k=window.document,l=k.documentElement,m={header:!0,footer:!0,loading:!0,destroy:!1,content:"",title:"",history:"",direction:"",data:""},n={html:/^<.+>$/};return"pushState"in window.history||(window.history.pushState=function(){},window.history.replaceState=function(){}),c.prototype={init:function(a,b,c){history.state?this.pushState(a,b,c):this.replaceState(a,b,c)},handleState:function(a,b,c,d){var e=window.location.search;if(this.timestamp){searc=e||"";var f=new RegExp("(?:\\?|&)timestamp=\\d+");e=e.replace(f,""),e=e?[e,"&",this.timestamp,"=",(new Date).getTime()].join(""):["?",this.timestamp,"=",(new Date).getTime()].join("")}c&&(c=c.split(":"),d=c[0],c=c.length>1?c[1]:"",c&&!/^\//.test(c)&&(c="/"+c));var g=[c||this.baseURI,e,a].join(""),b=b||document.title,h={el:a,uri:g};d=d||"push",d+="State",window.history[d]&&window.history[d](h,b,g),document.title=b},replaceState:function(a,b,c){return this.handleState(a,b,c,"replace")},pushState:function(a,b,c){return this.handleState(a,b,c,"push")}},d.init=function(){d.ViewCache={},d.viewWH(),d.initView(),d.setRem(),d.eventListener()},d.getDPR=function(){var a=window.devicePixelRatio;if(i.ios){if(a>=3)return 3;if(a>=2)return 2}return 1},d.setRem=function(){if(d.options.setRem){if("function"==typeof d.options.setRem)return d.options.setRem();var a=d.viewHeight,b=window.orientation;(90===b||-90===b||void 0===b)&&(a=d.viewWidth),a<d.normalMinWidth&&(a=d.normalMinWidth),a>d.normalMaxWidth&&(a=d.normalMaxWidth),rem=parseFloat(a*d.basePX/d.normalWidth).toFixed(2),l.style.fontSize=rem+"px",d.REM=rem}},d.initView=function(){var a=d.$views,b=a.find('[data-role="view"]'),e=a.find('[data-role="view"][data-actived]');e.removeAttr("data-actived"),e=e.length?e.eq(e.length-1):b.eq(b.length-1),e.attr("data-actived",!0);var g="#"+e.attr("id"),i=f(g).attr("data-history");b.each(function(){var a=f(this),b=a.attr("id");b="#"+b;var c=h.create({$view:a,el:b,mobis:{el:b}});d.getMobis(a,c.mobis),d.createMobiView(c)});var j=f('[data-mobi="container"]');j.length||(j=f('<div data-mobi="container"></div>').appendTo(f("body"))),j.attr("data-role","views"),d.$mobiView=j,d.activeView={el:g},d.history=new c({baseURI:d.baseURI,el:g,title:document.title,timestamp:d.historyTimeStamp,state:i}),d.loadToMobi(g),e.find('[data-role="loading"]').remove()},d.eventListener=function(){var a=d.$mobiView,b=a.tap?"tap":"click";a.on(b,d.checkAnchorClick),window.addEventListener("popstate",function(a){return a.state?d.goBack(a.state):void 0},!1),window.addEventListener("orientationchange",function(){d.setRem()})},d.loadToMobi=function(a){if(!a)return console.log("there is must be a view el");var b=d.getMobiView(a);if(!b.el)return console.log("there is no this view, can't to load it");d.headerAndFooter(b),d.loadingHandle(b);var c=d.$views.find(a);return d.$mobiView.append(c),b},d.viewWH=function(){var a=l.getBoundingClientRect(),b=a.width,c=a.height,e=window.orientation;return 90===e||-90===e||void 0===e?(d.viewWidth=b,d.viewHeight=c):(d.viewWidth=c,d.viewHeight=b),d.translateWidth=d.viewWidth+d.translateOffset,d.translateHeight=d.viewHeight+d.translateOffset,this},d.getMobis=function(a,b){for(var c in m){var d=a.attr("data-"+c);d="false"===d?!1:d||m[c],b[c]=d}return b},d.mobisViewOptions=function(a,b){b=b||{};for(var c in m){var d=m[c];d===b[c]&&delete b[c]}var e=f.extend({},a.mobis,b);return a.mobis=e,a},d.checkAnchorClick=function(a){var b=a.target;for(3===b.nodeType&&(b=b.parentNode);b!==this&&"A"!==b.tagName;)b=b&&b.parentNode?b.parentNode:this;var c=f(b),e=c.attr("data-ignore");if(!(""===e||e&&"false"!==e)){if(c.attr("data-to")){if(a.preventDefault(),d.translating)return console.log("translating");var g=c.attr("data-to");if(!g)return;var h=d.getMobis(c,{});return d.loadMobiView(g,h)}var i=c.attr("data-role");return"back"===i||"forward"===i?(a.preventDefault(),d.translating?console.log("translating"):window.history[i]&&window.history[i]()):void 0}},d.resize=function(){},d.created=function(a){if(!a)return!1;var b=d.ViewCache[a]||{};return b.mobis&&b.mobis.created?d.ViewCache[a]||!1:!1},d.isHtml=function(a){return n.html.test(a)},d.getEl=function(a){return"object"==typeof a&&(a=a.mobis.el),a},d.getMobiView=function(a){var a=d.getEl(a);return a?d.ViewCache[a]||{}:{}},d.createMobiView=function(a){var b=d.getEl(a);if(!b)return{};var c=d.created(b);return c?c:void(d.ViewCache[b]=a)},d.createdInDom=function(a){a=d.getEl(a);var b=f('[data-role="views"] > [data-role="view"]'+a);return b.length?b:!1},d.createDomView=function(a){a=a||{};var b=a.mobis||{},c=b.el;if(!c)return console.log("there is must be a view el");var e=d.createdInDom(c);if(e.length){var g=d.getMobiView(c);if(g.mobis.created)return g}var i=c.replace("#","");e=e.length?e:f("<"+d.markup+' data-role="view" id="'+i+'"/>');var g=h.create(a);g.$view=e,g.mobis=g.mobis||{},g.mobis.el=c,g.mobis.options=a,d.getMobis(e,g.mobis);var j=g.mobis.load;j&&j.call(g),d.$views.append(e),d.createMobiView(g),g.mobis.created=!0;var k=e.find('[data-role="content"]');k=k.length?k:d.isHtml(b.content)?f(b.content):"",k&&k.attr("data-role","content").appendTo(e);var l=b.loaded;return l&&l.call(g),g},d.getHTMLContent=function(a){return"function"==typeof a?a():a},d.setHF=function(a,b){b=b||"header";var c=a.$view,e=a.mobis,g=e[b]||"";if(g){var h=c.find('[data-role="'+b+'"]');if(g=d.getHTMLContent(g),d.isHtml(g)&&(h.remove(),h=f(g),h.attr("data-role",b)),h.length||(h="header"===b?d.$gheader.clone():d.$gfooter.clone()),h.show(),e.title){var i=h.find('[data-role="title"]');if(i.length){var j=e.title||i.text()||document.title||"";i.text(j)}}"header"===b?(c.find('[data-role="header"],[data-role="global-header"]').remove(),c.find('[data-role="content"]').before(h)):(c.find('[data-role="footer"],[data-role="global-footer"]').remove(),c.find('[data-role="content"]').after(h))}},d.headerAndFooter=function(a){var b=a.$view,c=b.find('[data-role="content"]');if(c.length){var e=b.find('[data-role="header"]'),f=b.find('[data-role="footer"]'),g=a.mobis;return g.header?d.setHF(a,"header"):e.hide(),g.footer?d.setHF(a,"footer"):f.hide(),this}},d.loadingHandle=function(a){var b=a.mobis,c=a.$view,e=c.find('[data-role="content"]');if(b.loading||b.content&&!d.isHtml(b.content)){if("background"===b.loading||b.content&&!d.isHtml(b.content))return e.addClass("content-loading"),this;var g=b.loading===!0?d.options.loading:b.loading;g=d.getHTMLContent(g);var h=f(g);h.attr("data-role","loading"),c.find('[data-role="content"]').append(h)}return this},d.appendContent=function(a,b,c){var d=a.$view,e=d.find('[data-role="content"]');b&&(e.length?e.html(b):d.html(b)),e.removeClass("content-loading"),c&&c()},d.contentHandle=function(a,b){var c=a.mobis,e=a.$view,g=e.find('[data-role="content"]');if(c.content){var h=d.getHTMLContent(c.content);if(d.isHtml(h))return d.appendContent(a,h,b);if(h)return f("<div/>").load(c.content,function(c){return d.appendContent(a,c,b)})}g.removeClass("content-loading"),e.find('[data-role="loading"]').remove(),b&&b()},d.doAnimation=function(a,b,c){var e=c.direction||"left";d.$mobiView.prepend(b),b.addClass("mobi-to-view").addClass(e).addClass("initial"),d.$mobiView.addClass("animate").addClass(e);var f=function(){return c.before&&c.before(),b.removeClass("initial")};setTimeout(f,1);var g=function(){return a.appendTo(d.$views),b.removeClass("mobi-to-view").removeClass(e),d.$mobiView.removeClass("animate").removeClass(e),c.after&&c.after()};return setTimeout(g,d.translateDuration)},d.loadContent=function(a,b){if(d.translating)return console.log("translating");b=b||{},a=d.getEl(a);var c=d.getMobiView(a);if(!c)return console.log("there is no this view, can't to load it");if(!a||a!==d.activeView.el){var e=d.createDomView(c),f=d.getMobiView(d.activeView.el),g=d.mobisViewOptions(e,b),h=g.mobis,i=(d.$views,d.$mobiView.find(d.activeView.el)),j=g.$view,k=h.perload;k&&k.call(g);var l=h.direction||"left";return e.mobis.direction=h.direction||d.translateDirection,1===e.mobis.directionTag?(l=f.mobis.direction,l=d.opposites[l]):l=d.directions[l],1===e.mobis.directionTag&&0===f.mobis.directionTag?(f.mobis.directionTag=-1,e.mobis.directionTag=0):(e.mobis.directionTag=0,f.mobis.directionTag=1),d.translating=!0,d.activeView.el=h.el,d.activeView.history=h.history,d.doAnimation(i,j,{direction:l,before:function(){d.$mobiView.css({overflow:"visible"}),d.loadToMobi(a)},after:function(){d.contentHandle(g,function(){var a=h.perloaded;a&&a.call(g),j.attr("data-actived",!0),d.translating=!1,d.$mobiView.css({overflow:"hidden"}),d.historyOptions={};var b=f.mobis.destroy,c=f.$view;if("view"===b)return c.empty();var e=c.find('[data-role="content"]');return"content"===b||b===!0?e.empty():"remove"===b?e.remove():void 0})}})}},d.loadMobiView=function(a,b){var c=d.getMobiView(a);if(!c.el)return console.log("load a view ,must be an el setting");c.mobis.directionTag=0,d.loadContent(a,b);var e=c.mobis,f=e.history||"push";"nochange"!==f&&d.history.handleState(a,e.title,f)},d.loadMobiBackView=function(a){a=a||{};var b=a.el,c=d.getMobiView(b),e=d.getMobiView(d.activeView.el),g=e.mobis||{},h=g.goback,i=g.reload,j=g.goforward,k=d.historyGoIndex;if("disabled"===h&&1===c.mobis.directionTag)return k=k?-k:1,history.go(k),d.historyGoIndex=0;if("disabled"===j&&-1===c.mobis.directionTag)return k=k?-k:-1,history.go(k),d.historyGoIndex=0;var l={};if(h&&"function"==typeof h&&1===c.mobis.directionTag&&(l=h.call(e,a,g)),j&&"function"==typeof j&&-1===c.mobis.directionTag&&(l=j.call(e,a,g)),i&&!c.mobis.directionTag&&a.el===g.el){if("function"==typeof i)return i.call(e,a,g);if(a.uri)return location.reload()}a=f.extend(a,d.historyOptions,l),d.loadContent(b,a)},d.goBack=function(a){return a=a||{},d.translating?console.log("translating"):d.loadMobiBackView(a)},e.prototype={view:function(a){if(a=a||{},a&&"string"==typeof a)return d.getMobiView(a);var b=a.el;if(!b)return console.log("there is must be a view el");var b=a.el;if(!b)return console.log("there is must be a view el");var c=d.created(b);if(c)return c;var e=d.createdInDom(b);return c=d.getMobiView(b),c.mobis=f.extend({el:b,created:!1},c.mobis||{},a.mobis),delete a.mobis,c=f.extend(c,a),e&&e.length?(a.mobis=c.mobis,c=h.create(a),c.$view=e,c.mobis=c.mobis||{},c.mobis.el=b,c.mobis.options=a,d.createMobiView(c),c.mobis.created=!0,this):(d.createMobiView(c),this)},load:function(a,b){return a=d.getEl(a),a?d.loadMobiView(a,b):console.log("load a view ,must be an el setting")},go:function(a,b){return a=parseInt(a),a&&(d.historyOptions=b||{},d.historyGoIndex=a,window.history.go(a)),this},goback:function(a){return d.historyOptions=a||{},window.history.back(),this},goforward:function(a){return d.historyOptions=a||{},window.history.forward(),this}},e})}();
=======
!function(){if(void 0===module.declare)throw"There is no global module.declare method!";var a=module.globals("$");module.declare("pm.mobi",[a,"pm","pm.view","os"],function(b){function c(a){return a.replace(o.path,"/")}function d(a){return d.history?d.history:(this.baseURI=a.baseURI,this.timestamp=a.timestamp,d.routeView=a.routeView||!1,d.routeBaseURI=a.routeBaseURI||"",this.init(a.el,a.title,a.state),void(d.history=this))}function e(a){var b=g('[data-role="views"]');return b.length?(e.setOptions(a),e.$views=b,e.$gheader=g('[data-role="views"] > [data-role="global-header"]'),e.$gfooter=g('[data-role="views"] > [data-role="global-footer"]'),void e.init(b)):console.log('there is must be a views el,data-role="views" setting')}function f(a){return f.mobi?(e.setOptions(a),f.mobi):(new e(a),f.mobi=this,this)}var g=b(a),h=b("pm"),i=h.ns("view"),j=b("os"),k=window.location.pathname,l=window.document,m=l.documentElement,n={header:!0,footer:!0,loading:!0,destroy:!1,content:"",title:"",history:"",direction:"",data:""},o={html:/^<.+>$/,path:/(?:\/){2,}/g};return"pushState"in window.history||(window.history.pushState=function(){},window.history.replaceState=function(){}),d.prototype={init:function(a,b,c){history.state?this.pushState(a,b,c):this.replaceState(a,b,c)},handleState:function(a,b,e,f){var g=window.location.search;if(d.routeView){var h=a.replace("#",""),i=d.routeBaseURI||"/";h=d.routeView[h]||d.routeView[a],g=[i,h||a.replace("#view_item_","")].join("/")}if(this.timestamp){g=g||"";var j=new RegExp("(?:\\?|&)timestamp=\\d+");g=g.replace(j,""),g=g?[g,"&",this.timestamp,"=",(new Date).getTime()].join(""):["?",this.timestamp,"=",(new Date).getTime()].join("")}e&&(e=e.split(":"),f=e[0],e=e.length>1?e[1]:"",/^\//.test(e)||(e="/"+e)),g=c(g);var k=d.routeView?"":"/"+a,l=c([e||this.baseURI,g,k].join("")),b=b||document.title,m={el:a,uri:l};f=f||"push",f+="State",window.history[f]&&window.history[f](m,b,l),document.title=b},replaceState:function(a,b,c){return this.handleState(a,b,c,"replace")},pushState:function(a,b,c){return this.handleState(a,b,c,"push")}},e.setOptions=function(a){a=a||{},a=g.extend(!0,a,e.options||{}),e.options=a,e.baseURI=k,e.zIndex=a.zIndex||100,e.normalWidth=a.normalWidth||640,e.normalMaxWidth=a.normalMaxWidth||768,e.normalMinWidth=a.normalMinWidth||320,e.basePX=a.normalPx||100,e.historyGoIndex=0,e.historyOptions={};var b=a.historyTimeStamp;b===!0&&(b="t"),e.historyTimeStamp=b?b:"",e.translateDuration=parseInt(a.duration||400),e.translateDirection=a.direction||"left",e.translateOffset=a.translateOffset||60,e.translateDelay=a.translateDelay||1,e.directions=a.directions||{left:"left",right:"right",up:"up",down:"down"},e.opposites=a.opposites||{left:"right",right:"left",up:"down",down:"up"},e.globalBeforeCallback=a.globalBeforeCallback,e.globalAfterCallback=a.globalAfterCallback,e.markup=a.markup||"div",d.routeView=d.routeView||a.routeView,d.routeBaseURI=d.routeBaseURI||a.routeBaseURI||""},e.init=function(){e.ViewCache={},e.viewWH(),e.initView(),e.setRem(),e.eventListener()},e.getDPR=function(){var a=window.devicePixelRatio;if(j.ios){if(a>=3)return 3;if(a>=2)return 2}return 1},e.setRem=function(){if(e.options.setRem){if("function"==typeof e.options.setRem)return e.options.setRem();var a=e.viewHeight,b=window.orientation;(90===b||-90===b||void 0===b)&&(a=e.viewWidth),a<e.normalMinWidth&&(a=e.normalMinWidth),a>e.normalMaxWidth&&(a=e.normalMaxWidth);var c=parseFloat(a*e.basePX/e.normalWidth).toFixed(2);m.style.fontSize=c+"px",e.REM=c}},e.initView=function(){var a=e.$views,b=a.find('[data-role="view"]'),c=a.find('[data-role="view"][data-actived]');c.removeAttr("data-actived"),c=c.length?c.eq(c.length-1):b.eq(b.length-1),c.attr("data-actived",!0);var f="#"+c.attr("id"),h=g(f).attr("data-history");b.each(function(){var a=g(this),b=a.attr("id");b="#"+b;var c=i.create({$view:a,el:b,mobis:{el:b}});e.getMobis(a,c.mobis),e.createMobiView(c)});var j=g('[data-mobi="container"]');j.length||(j=g('<div data-mobi="container"></div>').appendTo(g("body"))),j.attr("data-role","views"),e.$mobiView=j,e.activeView={el:f},e.history=new d({baseURI:e.baseURI,el:f,title:document.title,timestamp:e.historyTimeStamp,state:h}),e.loadToMobi(f),c.find('[data-role="loading"]').remove()},e.eventListener=function(){var a=e.$mobiView,b=a.tap?"tap":"click";a.on(b,e.checkAnchorClick),window.addEventListener("popstate",function(a){return a.state?e.goBack(a.state):void 0},!1),window.addEventListener("orientationchange",function(){e.setRem()})},e.loadToMobi=function(a){if(!a)return console.log("there is must be a view el");var b=e.getMobiView(a);if(!b.el)return console.log("there is no this view, can't to load it");e.headerAndFooter(b),e.loadingHandle(b);var c=e.$views.find(a);return e.$mobiView.append(c),b},e.viewWH=function(){var a=m.getBoundingClientRect(),b=a.width,c=a.height,d=window.orientation;return 90===d||-90===d||void 0===d?(e.viewWidth=b,e.viewHeight=c):(e.viewWidth=c,e.viewHeight=b),e.translateWidth=e.viewWidth+e.translateOffset,e.translateHeight=e.viewHeight+e.translateOffset,this},e.getMobis=function(a,b){for(var c in n){var d=a.attr("data-"+c);d="false"===d?!1:d||n[c],b[c]=d}return b},e.mobisViewOptions=function(a,b){b=b||{};for(var c in n){var d=n[c];d===b[c]&&delete b[c]}var e=g.extend({},a.mobis,b);return a.mobis=e,a},e.checkAnchorClick=function(a){var b=a.target;for(3===b.nodeType&&(b=b.parentNode);b!==this&&"A"!==b.tagName;)b=b&&b.parentNode?b.parentNode:this;var c=g(b),d=c.attr("data-ignore");if(!(""===d||d&&"false"!==d)){if(c.attr("data-to")){if(a.preventDefault(),e.translating)return console.log("translating");var f=c.attr("data-to");if(!f)return;var h=e.getMobis(c,{});return e.loadMobiView(f,h)}var i=c.attr("data-role");return"back"===i||"forward"===i?(a.preventDefault(),e.translating?console.log("translating"):window.history[i]&&window.history[i]()):void 0}},e.resize=function(){},e.created=function(a){if(!a)return!1;var b=e.ViewCache[a]||{};return b.mobis&&b.mobis.created?e.ViewCache[a]||!1:!1},e.isHtml=function(a){return o.html.test(a)},e.getEl=function(a){return"object"==typeof a&&(a=a.mobis.el),a},e.getMobiView=function(a){var a=e.getEl(a);return a?e.ViewCache[a]||{}:{}},e.createMobiView=function(a){var b=e.getEl(a);if(!b)return{};var c=e.created(b);return c?c:void(e.ViewCache[b]=a)},e.createdInDom=function(a){a=e.getEl(a);var b=g('[data-role="views"] > [data-role="view"]'+a);return b.length?b:!1},e.createDomView=function(a){a=a||{};var b=a.mobis||{},c=b.el;if(!c)return console.log("there is must be a view el");var d=e.createdInDom(c);if(d.length){var f=e.getMobiView(c);if(f.mobis.created)return f}var h=c.replace("#","");d=d.length?d:g("<"+e.markup+' data-role="view" id="'+h+'"/>');var f=i.create(a);f.$view=d,f.mobis=f.mobis||{},f.mobis.el=c,f.mobis.options=a,e.getMobis(d,f.mobis);var j=f.mobis.load;j&&j.call(f,f.mobis),e.$views.append(d),e.createMobiView(f),f.mobis.created=!0;var k=d.find('[data-role="content"]');k=k.length?k:e.isHtml(b.content)?g(b.content):"",k&&k.attr("data-role","content").appendTo(d);var l=b.loaded;return l&&l.call(f,f.mobis),f},e.getHTMLContent=function(a){return"function"==typeof a?a():a},e.setHF=function(a,b){b=b||"header";var c=a.$view,d=a.mobis,f=d[b]||"";if(f){var h=c.find('[data-role="'+b+'"]');if(f=e.getHTMLContent(f),e.isHtml(f)&&(h.remove(),h=g(f),h.attr("data-role",b)),h.length||(h="header"===b?e.$gheader.clone():e.$gfooter.clone()),h.show(),d.title){var i=h.find('[data-role="title"]');if(i.length){var j=d.title||i.text()||document.title||"";i.text(j)}}"header"===b?(c.find('[data-role="header"],[data-role="global-header"]').remove(),c.find('[data-role="content"]').before(h)):(c.find('[data-role="footer"],[data-role="global-footer"]').remove(),c.find('[data-role="content"]').after(h))}},e.headerAndFooter=function(a){var b=a.$view,c=b.find('[data-role="content"]');if(c.length){var d=b.find('[data-role="header"]'),f=b.find('[data-role="footer"]'),g=a.mobis;return g.header?e.setHF(a,"header"):d.hide(),g.footer?e.setHF(a,"footer"):f.hide(),this}},e.loadingHandle=function(a){var b=a.mobis,c=a.$view,d=c.find('[data-role="content"]');if(b.loading||b.content&&!e.isHtml(b.content)){if("background"===b.loading||b.content&&!e.isHtml(b.content))return d.addClass("content-loading"),this;var f=b.loading===!0?e.options.loading:b.loading;f=e.getHTMLContent(f);var h=g(f);h.attr("data-role","loading"),c.find('[data-role="content"]').append(h)}return this},e.appendContent=function(a,b,c){var d=a.$view,e=d.find('[data-role="content"]');b&&(e.length?e.html(b):d.html(b)),e.removeClass("content-loading"),c&&c()},e.contentHandle=function(a,b){var c=a.mobis,d=a.$view,f=d.find('[data-role="content"]');if(c.content){var h=e.getHTMLContent(c.content);if(e.isHtml(h))return e.appendContent(a,h,b);if(h)return g("<div/>").load(c.content,function(c){return e.appendContent(a,c,b)})}f.removeClass("content-loading"),d.find('[data-role="loading"]').remove(),b&&b()},e.doAnimation=function(a,b,c){var d=c.direction||"left";e.$mobiView.prepend(b),b.addClass("mobi-to-view").addClass(d).addClass("initial"),e.$mobiView.addClass("animate").addClass(d);var f=function(){return c.before&&c.before(),b.removeClass("initial")};setTimeout(f,1);var g=function(){return a.appendTo(e.$views),b.removeClass("mobi-to-view").removeClass(d),e.$mobiView.removeClass("animate").removeClass(d),c.after&&c.after()};return setTimeout(g,e.translateDuration)},e.loadContent=function(a,b){if(e.translating)return console.log("translating");b=b||{},a=e.getEl(a);var c=e.getMobiView(a);if(!c)return console.log("there is no this view, can't to load it");if(!a||a!==e.activeView.el){var d=e.createDomView(c),f=e.getMobiView(e.activeView.el),g=e.mobisViewOptions(d,b),h=g.mobis,i=(e.$views,e.$mobiView.find(e.activeView.el)),j=g.$view,k=h.perload;k&&k.call(g,g.mobis);var l=h.direction||e.translateDirection;return d.mobis.direction=l,1===d.mobis.directionTag?(l=f.mobis.direction,l=e.opposites[l]):l=e.directions[l],1===d.mobis.directionTag&&0===f.mobis.directionTag?(f.mobis.directionTag=-1,d.mobis.directionTag=0):(d.mobis.directionTag=0,f.mobis.directionTag=1),e.translating=!0,e.activeView.el=h.el,e.activeView.history=h.history,e.doAnimation(i,j,{direction:l,before:function(){e.globalBeforeCallback&&e.globalBeforeCallback(g,g.mobis),e.$mobiView.css({overflow:"visible"}),e.loadToMobi(a)},after:function(){e.contentHandle(g,function(){var a=h.perloaded;a&&a.call(g,g.mobis),e.globalAfterCallback&&e.globalAfterCallback.call(g,g.mobis),j.attr("data-actived",!0),e.translating=!1,e.$mobiView.css({overflow:"hidden"}),e.historyOptions={};var b=f.mobis.destroy,c=f.$view;if("view"===b)return c.empty();var d=c.find('[data-role="content"]');return"content"===b||b===!0?d.empty():"remove"===b?d.remove():void 0})}})}},e.loadMobiView=function(a,b){var c=e.getMobiView(a);if(!c.el)return console.log("load a view ,must be an el setting");c.mobis.directionTag=0,e.loadContent(a,b);var d=c.mobis,f=d.history||"push";"nochange"!==f&&e.history.handleState(a,d.title,f)},e.loadMobiBackView=function(a){a=a||{};var b=a.el,c=e.getMobiView(b),d=e.getMobiView(e.activeView.el),f=d.mobis||{},h=f.goback,i=f.reload,j=f.goforward,k=e.historyGoIndex;if("disabled"===h&&1===c.mobis.directionTag)return k=k?-k:1,history.go(k),e.historyGoIndex=0;if("disabled"===j&&-1===c.mobis.directionTag)return k=k?-k:-1,history.go(k),e.historyGoIndex=0;var l={};if(h&&"function"==typeof h&&1===c.mobis.directionTag&&(l=h.call(d,a,f)),j&&"function"==typeof j&&-1===c.mobis.directionTag&&(l=j.call(d,a,f)),i&&!c.mobis.directionTag&&a.el===f.el){if("function"==typeof i)return i.call(d,a,f);if(a.uri)return location.reload()}a=g.extend(a,e.historyOptions,l),e.loadContent(b,a)},e.goBack=function(a){return a=a||{},e.translating?console.log("translating"):e.loadMobiBackView(a)},f.prototype={view:function(a){if(a=a||{},a&&"string"==typeof a)return e.getMobiView(a);var b=a.el;if(!b)return console.log("there is must be a view el");var b=a.el;if(!b)return console.log("there is must be a view el");var c=e.created(b);if(c)return c;var d=e.createdInDom(b);return c=e.getMobiView(b),c.mobis=g.extend({el:b,created:!1},c.mobis||{},a.mobis),delete a.mobis,c=g.extend(c,a),d&&d.length?(a.mobis=c.mobis,c=i.create(a),c.$view=d,c.mobis=c.mobis||{},c.mobis.el=b,c.mobis.options=a,e.createMobiView(c),c.mobis.created=!0,this):(e.createMobiView(c),this)},load:function(a,b){return a=e.getEl(a),a?e.loadMobiView(a,b):console.log("load a view ,must be an el setting")},go:function(a,b){return a=parseInt(a),a&&(e.historyOptions=b||{},e.historyGoIndex=a,window.history.go(a)),this},goback:function(a){return e.historyOptions=a||{},window.history.back(),this},goforward:function(a){return e.historyOptions=a||{},window.history.forward(),this}},f})}();
>>>>>>> d5323f8dd6e05260344fee86d650455c6f6cfdc1
